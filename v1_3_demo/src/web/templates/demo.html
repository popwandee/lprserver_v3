<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Camera v1.3 - Interactive Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/base.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet">
    <style>
        .demo-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 10px;
            text-align: center;
        }
        .demo-video-container {
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 2rem;
        }
        .demo-video {
            width: 100%;
            height: 400px;
            object-fit: cover;
        }
        .demo-controls {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        .demo-status {
            background: #e9ecef;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        .detection-overlay {
            position: relative;
            display: inline-block;
        }
        .detection-box {
            position: absolute;
            border: 2px solid #00ff00;
            background: rgba(0, 255, 0, 0.1);
            pointer-events: none;
        }
        .demo-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <!-- Demo Banner -->
    <div class="demo-banner">
        <h1>üöÄ AI Camera v1.3 - Interactive Demo</h1>
        <p>Experience the AI Camera system with simulated video and detection</p>
    </div>

    <div class="container-fluid">
        <!-- Demo Info -->
        <div class="demo-info">
            <h4>üìã Demo Information</h4>
            <ul>
                <li><strong>Mode:</strong> Demo Mode (Using video file instead of real camera)</li>
                <li><strong>Video Source:</strong> example.mp4</li>
                <li><strong>Detection:</strong> Simulated AI detection results</li>
                <li><strong>Features:</strong> Real-time video streaming, simulated detection, health monitoring</li>
            </ul>
        </div>

        <div class="row">
            <!-- Video Stream -->
            <div class="col-md-8">
                <div class="demo-video-container">
                    <img id="demo-video" class="demo-video" src="/demo/video" alt="Demo Video Stream">
                    <div id="detection-overlay" class="detection-overlay"></div>
                </div>
            </div>

            <!-- Demo Controls -->
            <div class="col-md-4">
                <div class="demo-controls">
                    <h4>üéÆ Demo Controls</h4>
                    <div class="d-grid gap-2">
                        <button id="start-demo" class="btn btn-success">Start Demo</button>
                        <button id="stop-demo" class="btn btn-danger">Stop Demo</button>
                        <button id="trigger-detection" class="btn btn-primary">Trigger Detection</button>
                        <button id="reset-demo" class="btn btn-warning">Reset Demo</button>
                    </div>
                </div>

                <!-- Demo Status -->
                <div class="demo-status">
                    <h4>üìä Demo Status</h4>
                    <div id="demo-status-display">
                        <p><strong>Camera:</strong> <span id="camera-status">Initializing...</span></p>
                        <p><strong>Detection:</strong> <span id="detection-status">Ready</span></p>
                        <p><strong>Frame Count:</strong> <span id="frame-count">0</span></p>
                        <p><strong>Detection Count:</strong> <span id="detection-count">0</span></p>
                    </div>
                </div>

                <!-- Detection Results -->
                <div class="demo-status">
                    <h4>üîç Latest Detection</h4>
                    <div id="detection-results">
                        <p>No detections yet...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Information -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4>üíª System Information</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <h6>CPU Architecture</h6>
                                <p id="system-info-cpu">Demo Mode</p>
                            </div>
                            <div class="col-md-3">
                                <h6>AI Accelerator</h6>
                                <p id="system-info-ai-accelerator">Demo AI Processor</p>
                            </div>
                            <div class="col-md-3">
                                <h6>OS & Kernel</h6>
                                <p id="system-info-os">Demo System</p>
                            </div>
                            <div class="col-md-3">
                                <h6>Demo Mode</h6>
                                <p><span class="badge bg-success">Active</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Connection Status -->
        <div class="row mt-3">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üîó Server Connection</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Status:</strong> <span id="main-server-connection-status" class="status-indicator status-online"></span> <span id="main-server-connection-text">Connected (Demo)</span></p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üì° Data Sending</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Status:</strong> <span id="main-data-sending-status" class="status-indicator status-online"></span> <span id="main-data-sending-text">Active (Demo)</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="{{ url_for('static', filename='js/base.js') }}"></script>
    <script>
        // Demo-specific JavaScript
        class DemoManager {
            constructor() {
                this.socket = null;
                this.isRunning = false;
                this.frameCount = 0;
                this.detectionCount = 0;
                this.detectionResults = [];
                this.init();
            }

            init() {
                this.initializeWebSocket();
                this.setupEventHandlers();
                this.startDemo();
            }

            initializeWebSocket() {
                this.socket = io();
                
                this.socket.on('connect', () => {
                    console.log('Connected to demo server');
                    this.updateStatus('Connected to demo server', 'success');
                });

                this.socket.on('demo_status_update', (data) => {
                    this.updateDemoStatus(data);
                });

                this.socket.on('demo_detection_response', (data) => {
                    this.handleDetectionResponse(data);
                });

                this.socket.on('disconnect', () => {
                    console.log('Disconnected from demo server');
                    this.updateStatus('Disconnected from demo server', 'error');
                });
            }

            setupEventHandlers() {
                document.getElementById('start-demo').addEventListener('click', () => {
                    this.startDemo();
                });

                document.getElementById('stop-demo').addEventListener('click', () => {
                    this.stopDemo();
                });

                document.getElementById('trigger-detection').addEventListener('click', () => {
                    this.triggerDetection();
                });

                document.getElementById('reset-demo').addEventListener('click', () => {
                    this.resetDemo();
                });
            }

            startDemo() {
                this.isRunning = true;
                this.updateStatus('Demo started', 'success');
                this.requestDemoStatus();
                
                // Start periodic status updates
                this.statusInterval = setInterval(() => {
                    if (this.isRunning) {
                        this.requestDemoStatus();
                    }
                }, 2000);
            }

            stopDemo() {
                this.isRunning = false;
                this.updateStatus('Demo stopped', 'warning');
                if (this.statusInterval) {
                    clearInterval(this.statusInterval);
                }
            }

            resetDemo() {
                this.frameCount = 0;
                this.detectionCount = 0;
                this.detectionResults = [];
                this.updateDisplay();
                this.updateStatus('Demo reset', 'info');
            }

            triggerDetection() {
                if (this.socket) {
                    this.socket.emit('demo_detection_request');
                    this.updateStatus('Detection triggered', 'info');
                }
            }

            requestDemoStatus() {
                if (this.socket) {
                    this.socket.emit('demo_status_request');
                }
            }

            updateDemoStatus(data) {
                if (data.camera) {
                    document.getElementById('camera-status').textContent = 
                        data.camera.initialized ? 'Active' : 'Inactive';
                    document.getElementById('frame-count').textContent = 
                        data.camera.frame_count || 0;
                }

                if (data.detection) {
                    document.getElementById('detection-status').textContent = 
                        data.detection.status || 'Ready';
                }
            }

            handleDetectionResponse(data) {
                if (data.success && data.detections) {
                    this.detectionCount++;
                    this.detectionResults = data.detections;
                    this.updateDetectionDisplay();
                    this.drawDetectionBoxes();
                    this.updateStatus(`Detection completed: ${data.detections.length} objects found`, 'success');
                } else {
                    this.updateStatus('Detection failed', 'error');
                }
            }

            updateDetectionDisplay() {
                const resultsDiv = document.getElementById('detection-results');
                if (this.detectionResults.length > 0) {
                    let html = '';
                    this.detectionResults.forEach((detection, index) => {
                        html += `
                            <div class="mb-2">
                                <strong>Object ${index + 1}:</strong><br>
                                Type: ${detection.type}<br>
                                Confidence: ${(detection.confidence * 100).toFixed(1)}%<br>
                                ${detection.text ? `Text: ${detection.text}<br>` : ''}
                            </div>
                        `;
                    });
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<p>No detections yet...</p>';
                }
                document.getElementById('detection-count').textContent = this.detectionCount;
            }

            drawDetectionBoxes() {
                const overlay = document.getElementById('detection-overlay');
                overlay.innerHTML = '';

                this.detectionResults.forEach((detection) => {
                    if (detection.bbox) {
                        const [x, y, w, h] = detection.bbox;
                        const box = document.createElement('div');
                        box.className = 'detection-box';
                        box.style.left = `${x}px`;
                        box.style.top = `${y}px`;
                        box.style.width = `${w - x}px`;
                        box.style.height = `${h - y}px`;
                        box.title = `${detection.type} (${(detection.confidence * 100).toFixed(1)}%)`;
                        overlay.appendChild(box);
                    }
                });
            }

            updateDisplay() {
                document.getElementById('frame-count').textContent = this.frameCount;
                document.getElementById('detection-count').textContent = this.detectionCount;
            }

            updateStatus(message, type) {
                console.log(`[${type.toUpperCase()}] ${message}`);
                // You can add toast notifications here if needed
            }
        }

        // Initialize demo when page loads
        document.addEventListener('DOMContentLoaded', function() {
            window.demoManager = new DemoManager();
        });
    </script>
</body>
</html>
